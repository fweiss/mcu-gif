#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>

#include "gd.h"

void reader() {
    char buf[] = {
0x47, 0x49, 0x46, 0x38, 0x39, 0x61, 0x0A, 0x00, 0x0A, 0x00, 0x91, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x21, 0xF9, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x0A, 0x00, 0x00, 0x02, 0x16, 0x8C, 0x2D, 0x99, 0x87, 0x2A, 0x1C, 0xDC, 0x33, 0xA0, 0x02, 0x75, 0xEC, 0x95, 0xFA, 0xA8, 0xDE, 0x60, 0x8C, 0x04, 0x91, 0x4C, 0x01, 0x00, 0x3B
    };
    int fd = open("sample_1.gif", O_RDONLY);
    printf("fd: %d\n", fd);

//    unsigned char b[2];
//    size_t c = read(fd, buf, sizeof(buf));
//    if (c == -1) {
//        exit(1);
//    }
//    printf("size: %l\n", c);
//    printf("b: %x\n", b[0]);
    gd_init(read);
    gd_begin(fd);
    gd_info_t info;
    gd_info_get(&info);
    printf("info status %d\n", info.status);
    gd_colortab_t colortab;
    gd_global_colortab_get(&colortab);
    printf("color tab size %d\n", colortab.size);


    uint16_t ipixels[1024];
    gd_frame_t frame;
    frame.pixels = ipixels;
    gd_render_frame(&frame);
    printf("render frame: istatus: %d\n", frame.status);
    printf("pixels 0. 9, 49: %d %d %d", ipixels[0], ipixels[4], ipixels[49]);
}
